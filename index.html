<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cata de Cervezas Músics</title>
  <style>
    :root {
      --bg: #0b0f14;
      --card: #141a22;
      --text: #e6edf3;
      --muted: #9fb1c7;
      --accent: #6ac2ff;
      --border: #223041;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; background: var(--bg); color: var(--text); }
    header {
      position: sticky; top: 0; z-index: 10; backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(11,15,20,.9), rgba(11,15,20,.6));
      border-bottom: 1px solid var(--border); padding: 12px 16px;
    }
    header h1 { margin: 0; font-size: 18px; }
    header .sub { color: var(--muted); font-size: 12px; margin-top: 4px; }

    .container { max-width: 980px; margin: 16px auto 80px; padding: 0 12px; }

    .toolbar { display: flex; flex-wrap: wrap; gap: 8px; margin: 8px 0 16px; }
    .toolbar button, .toolbar select, .toolbar input[type="file"] {
      background: var(--card); color: var(--text); border: 1px solid var(--border);
      padding: 10px 12px; border-radius: 12px; cursor: pointer; font-size: 14px;
    }
    .toolbar button:hover { border-color: var(--accent); }
    .toolbar .spacer { flex: 1; }

    .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 680px) { .grid { grid-template-columns: 1fr 1fr; } }
    @media (min-width: 980px) { .grid { grid-template-columns: 1fr 1fr 1fr; } }

    .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 14px; }
    .title { font-weight: 700; font-size: 16px; margin: 0 0 6px; }
    .meta { color: var(--muted); font-size: 13px; margin-bottom: 8px; }
    .desc { font-size: 13px; color: #c8d6e5; margin-bottom: 10px; }

    .row { display: grid; grid-template-columns: 100px 1fr 46px; gap: 8px; align-items: center; margin: 6px 0; }
    .row label { font-size: 13px; color: var(--muted); }
    input[type="range"] { width: 100%; }
    .val { text-align: right; font-variant-numeric: tabular-nums; color: var(--accent); }

    textarea { width: 100%; min-height: 72px; resize: vertical; padding: 8px; border-radius: 12px; background: #0e141b; color: var(--text); border: 1px solid var(--border); font-size: 13px; }

    .compare { margin-top: 24px; padding: 16px; border: 1px dashed var(--border); border-radius: 16px; background: #0e141b; }
    .compare h3 { margin: 0 0 8px; font-size: 16px; }
    .compare .table { width: 100%; border-collapse: collapse; }
    .compare .table th, .compare .table td { border: 1px solid var(--border); padding: 8px; font-size: 13px; }
    .muted { color: var(--muted); }

    footer { position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(0deg, rgba(11,15,20,1), rgba(11,15,20,.6)); border-top: 1px solid var(--border); padding: 10px 12px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    footer .hint { color: var(--muted); font-size: 12px; }
    /* === MODO PANTALLA COMPLETA CON DESLIZAMIENTO === */
  .viewport{overflow:hidden;height:calc(100dvh - 140px);}
  .track{display:flex;height:100%;transition:transform 300ms ease;touch-action:pan-y;}
  .slide{flex:0 0 100vw;max-width:100vw;padding:16px;display:flex;flex-direction:column;gap:8px}
  .pager{display:flex;gap:6px;justify-content:center;margin:12px 0}
  .pager button{width:10px;height:10px;border-radius:50%;border:1px solid var(--border);background:var(--card);cursor:pointer}
  .pager button.active{background:var(--accent);border-color:var(--accent)}
</style>
</head>
<body>
  <header>
    <h1>Cata de Cervezas Músics</h1>
    <div class="sub">Rellena en el móvil. Tu progreso se guarda automáticamente en este dispositivo.</div>
  </header>

  <div class="container">
    <div class="toolbar">
      <label style="display:flex; align-items:center; gap:8px;">Importar JSON <input id="importJson" type="file" accept="application/json" /></label>
        <!-- Selector de densidad (1/2/3 columnas) -->
        <select id="density" aria-label="Densidad de tarjetas">
          <option value="1">1 columna</option>
          <option value="2" selected>2 columnas</option>
          <option value="3">3 columnas</option>
        </select>
        <button id="resetAll">Borrar todo</button>
        <div class="spacer"></div>
    </div>

    <!-- Contenedor de tarjetas usado por render() -->
    <div id="cards" class="grid" aria-live="polite"></div>

    <!-- Viewport / track / pager para modo pantalla completa -->
    <div class="viewport" role="region" aria-label="Modo pantalla completa">
      <div id="track" class="track"></div>
    </div>
    <div id="pager" class="pager" aria-hidden="false"></div>
  </div>

  <footer>
    <span class="hint">Sugerencia: añade esta página a tu pantalla de inicio para acceso rápido.</span>
  </footer>

  <script>
    const beers = [
      { id: 'schneider-hopfenweisse', nombre: 'Schneider Weisse Hopfenweisse', estilo: 'Weizendoppelbock (Alemania, 8.2%)', desc: 'Trigo fuerte con dry hopping. Plátano, clavo y lúpulo herbal.' },
      { id: 'cloudwater-pale', nombre: 'Cloudwater Pale Ale', estilo: 'Pale Ale (Inglaterra, 5%)', desc: 'Ligera y refrescante, notas cítricas y florales.' },
      { id: 'soma-born', nombre: 'Soma Born & Raised', estilo: 'Double IPA (España, 8%)', desc: 'Tropical, resinosa y equilibrada. IPA moderna de Girona.' },
      { id: 'oh-mylar', nombre: 'Other Half – Mylar Dust', estilo: 'DDH Imperial IPA (EE.UU., 8.5%)', desc: 'Aroma explosivo: mango, melocotón, pino. Textura cremosa.' },
      { id: 'oh-citra-mosaic', nombre: 'Other Half – Citra + Mosaic', estilo: 'DDH Imperial IPA (EE.UU., 8.5%)', desc: 'Más seca y cítrica: pomelo y resina.' },
      { id: 'soma-boom', nombre: 'Soma – Boom', estilo: 'Triple IPA (España, 10%)', desc: 'Potente y frutal, dulzor alcohólico equilibrado.' },
      { id: 'spon-mix', nombre: 'SPON – Mix Down III', estilo: 'Salvaje con Xarel·lo y Parellada (España, 7%)', desc: 'Ácida, vinosa y con madera.' },
      { id: 'spon-wild', nombre: 'SPON – Wild Beats', estilo: 'Barrel Aged con Frambuesa (España, 7%)', desc: 'Fruta roja, acidez punzante, toque balsámico.' },
      { id: 'tilquin-pinot-gris', nombre: 'Tilquin – Oude Pinot Gris à l’ancienne', estilo: 'Lambic con uva Pinot Gris (Bélgica, 7%)', desc: 'Ácida, elegante, vinoso-terrosa.' }
    ];

    const storageKey = 'cata-cervezas-v1';

    function loadState() {
      try { return JSON.parse(localStorage.getItem(storageKey)) || {}; } catch { return {}; }
    }
    function saveState(state) {
      localStorage.setItem(storageKey, JSON.stringify(state));
    }

    function render() {
      const state = loadState();
      const root = document.getElementById('cards');
      root.innerHTML = '';

      beers.forEach(b => {
        const s = state[b.id] || { aroma: 3, sabor: 3, cuerpo: 3, final: 3, notas: '' };
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `$1${row('Aroma', 'aroma', s.aroma, b.id)}$2${row('Sabor', 'sabor', s.sabor, b.id)}$3${row('Cuerpo', 'cuerpo', s.cuerpo, b.id)}$4${row('Final', 'final', s.final, b.id)}
          <div style="margin-top:10px">
            <label class="muted" for="${b.id}-notas">Comentarios</label>
            <textarea id="${b.id}-notas" placeholder="Tus notas...">${escapeHtml(s.notas || '')}</textarea>
          </div>
        `;
        root.appendChild(card);

        ['aroma','sabor','cuerpo','final'].forEach(k => {
          const input = card.querySelector(`#${b.id}-${k}`);
          const out = card.querySelector(`#${b.id}-${k}-val`);
          input.addEventListener('input', () => { out.textContent = input.value; commit(b.id, k, Number(input.value)); });
        });
        const ta = card.querySelector(`#${b.id}-notas`);
        ta.addEventListener('input', () => commit(b.id, 'notas', ta.value));
      });

      updateDensity();
    }

    function row(labelTxt, key, value, id){
      return `
        <div class="row">
          <label for="${id}-${key}">${labelTxt}</label>
          <input type="range" min="1" max="5" step="1" id="${id}-${key}" value="${value}" />
          <div class="val" id="${id}-${key}-val">${value}</div>
        </div>
      `;
    }

    // Helper to ensure unique id prefix per render row
        function commit(id, key, value){
      const state = loadState();
      state[id] = state[id] || { aroma: 3, sabor: 3, cuerpo: 3, final: 3, notas: '' };
      state[id][key] = value;
      saveState(state);
    }

    function updateDensity(){
      const sel = document.getElementById('density');
      const grid = document.getElementById('cards');
      const val = Number(sel.value);
      if (val === 1) grid.style.gridTemplateColumns = '1fr';
      if (val === 2) grid.style.gridTemplateColumns = '1fr 1fr';
      if (val === 3) grid.style.gridTemplateColumns = '1fr 1fr 1fr';
    }

    function escapeHtml(s){
      return s.replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }

    function importJSONFile(file){
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          localStorage.setItem(storageKey, JSON.stringify(data));
          render();
        } catch(e){ alert('Archivo JSON no válido'); }
      };
      reader.readAsText(file);
    }

    

    // === Slider pantalla completa ===
    let current = 0;
    function goto(i){
      current = Math.max(0, Math.min(i, beers.length-1));
      const track = document.getElementById('track');
      if (track) track.style.transform = 'translateX(' + (-current*100) + 'vw)';
      updatePagerActive();
      window.scrollTo(0,0);
    }
    function buildPager(){
      const pager = document.getElementById('pager');
      if (!pager) return;
      pager.innerHTML = '';
      beers.forEach((_,i)=>{
        const dot = document.createElement('button');
        if (i===current) dot.classList.add('active');
        dot.addEventListener('click', ()=>goto(i));
        pager.appendChild(dot);
      });
    }
    function updatePagerActive(){
      const dots = Array.from(document.querySelectorAll('#pager button'));
      dots.forEach((d,i)=>d.classList.toggle('active', i===current));
    }
    function attachSwipe(el){
      if (!el || attachSwipe._bound) return; attachSwipe._bound = true;
      let startX = 0, dx = 0, touching = false;
      el.addEventListener('touchstart', e=>{ touching = true; startX = e.touches[0].clientX; dx = 0; }, {passive:true});
      el.addEventListener('touchmove', e=>{ if(!touching) return; dx = e.touches[0].clientX - startX; }, {passive:true});
      el.addEventListener('touchend', ()=>{ if(!touching) return; touching = false; if (Math.abs(dx) > 50){ if (dx < 0) goto(current+1); else goto(current-1); } });
      document.addEventListener('keydown', e=>{ if(e.key==='ArrowRight') goto(current+1); if(e.key==='ArrowLeft') goto(current-1); });
    }
    function renderFull(){
      const state = loadState();
      const track = document.getElementById('track');
      if (!track) return;
      track.innerHTML='';
      beers.forEach(b => {
        const s = state[b.id] || { aroma: 3, sabor: 3, cuerpo: 3, final: 3, notas: '' };
        const slide = document.createElement('section');
        slide.className = 'slide';
        slide.innerHTML = `
          <div class=\"title\">${b.nombre}</div>
          <div class=\"meta\">${b.estilo}</div>
          <div class=\"desc\">${b.desc}</div>
          ${row('Aroma','aroma', s.aroma, b.id)}
          ${row('Sabor','sabor', s.sabor, b.id)}
          ${row('Cuerpo','cuerpo', s.cuerpo, b.id)}
          ${row('Final','final', s.final, b.id)}
          <div style=\"margin-top:10px\">
            <label class=\"muted\" for=\"${b.id}-notas\">Comentarios</label>
            <textarea id=\"${b.id}-notas\" placeholder=\"Tus notas...\">${escapeHtml(s.notas || '')}</textarea>
          </div>`;
        track.appendChild(slide);
        ['aroma','sabor','cuerpo','final'].forEach(k => {
          const input = slide.querySelector(`#${b.id}-${k}`);
          const out = slide.querySelector(`#${b.id}-${k}-val`);
          if (input && out) input.addEventListener('input', () => { out.textContent = input.value; commit(b.id, k, Number(input.value)); });
        });
        const ta = slide.querySelector(`#${b.id}-notas`);
        if (ta) ta.addEventListener('input', () => commit(b.id, 'notas', ta.value));
      });
      buildPager();
      attachSwipe(track);
      goto(current);
    }

    // Events (comprobamos existencia antes de adjuntar listeners para evitar errores en entornos sin DOM completo)
    const inputImportJson = document.getElementById('importJson');
    if (inputImportJson) inputImportJson.addEventListener('change', (e)=>{
      if (e.target.files && e.target.files[0]) importJSONFile(e.target.files[0]);
    });

    const selDensity = document.getElementById('density');
    if (selDensity) selDensity.addEventListener('change', updateDensity);

    const btnResetAll = document.getElementById('resetAll');
    if (btnResetAll) btnResetAll.addEventListener('click', ()=>{
      if (confirm('¿Seguro que quieres borrar todas las notas guardadas en este dispositivo?')){
        localStorage.removeItem(storageKey);
        render();
      }
    });

    // Initial render
    renderFull();
  </script>
</body>
</html>
